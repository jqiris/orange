<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>
        Pinus
    </title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <meta http-equiv="content-style-type" content="text/css" />
    <meta http-equiv="content-scripte-type" content="text/javascript" />
    <meta name="author" content="netease" />
    <meta name="version" content="1.0" />
    <meta name="keywords" content="pinus" />
    <link type="text/css" rel="stylesheet" href="css/base.css" />
    <script src="js/lib/build/build.js" type="text/javascript"></script>
    <script src="pomelo/protobuf.js" type="text/javascript"></script>
    <script src="pomelo/protocol.js" type="text/javascript"></script>
    <script src="pomelo/pomelo.js" type="text/javascript"></script>
    <script type="text/javascript">
        require('boot');
    </script>
    <script type="text/javascript">
        var pomelo = window.pomelo;
        var host = "127.0.0.1";
        var port = "8288";
        var uid = 0;
        var nickname = "";
        var token = "";


        //pomelo init
        pomeloInit()

        function setUserInfo() {
            uid = document.getElementById("user_id").value;
            uid = parseInt(uid, 10);
            if (isNaN(uid) || uid < 1) {
                alert("Please enter a user_id")
                return
            }
            console.log("user_id:", uid)
        }



        function pomeloInit() {
            pomelo.init({
                host: host,
                port: port,
                log: true,
                useProtobuf: true,
                protoPath: "pomelo/protos.proto",
                protoPackage: "protos"
            }, function() {
                console.log("pomelo init succeeded");
            })
        }

        function pomeloRequest(msgId, reqKey, reqData, callback) {
            var data = {
                msgId: msgId,
            }
            data[reqKey] = reqData
            console.log("pomeloRequest:", data)
            pomelo.request("GateServer.ChanReq", data, function(data) {
                callback(data)
            });
        }

        function login() {
            if (uid == null || uid < 1) {
                alert("Please enter a user_id")
                return
            }
            var data = {
                uid: uid,
                nickname: nickname,
                token: token
            }
            pomeloRequest(1, "loginRequest", data, function(data) {
                console.log(data)
                var resp = data.loginResponse
                nickname = resp.nickname
                console.log("nickname:", nickname)
            })
        }

        function createRoom() {
            var data = {
                uid: uid,
                gid: 1001
            }
            pomeloRequest(4, "mjRoomCreateRequest", data, function(data) {
                console.log(data)
            })
        }
    </script>
</head>

<body>
    <div class="g-doc">
        <div class="g-banner" style="border:none">
            <div class="logo">
                <div class="img"></div>
            </div>
        </div>
        <div class="g-background">
            <div class="g-content">
                Welcome to Pinus
            </div>
        </div>
        <div class="g-link">
            Home:
            <a href="https://github.com/node-pinus/pinus">https://github.com/node-pinus/pinus</a>
        </div>
        <div class="g-button">
            用户ID:<input type="text" name="user_id" id="user_id" /><br/><input id="setUserInfo" type="button" value="设置用户信息" onclick="setUserInfo()" />
        </div>
        <div class="g-button">
            <input id="login" type="button" value="Test login" onclick="login()" /><br/>
            <input id="createRoom" type="button" value="Test createRoom" onclick="createRoom()" />
        </div>
    </div>
</body>

</html>